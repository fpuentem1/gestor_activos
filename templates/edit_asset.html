{% extends "base.html" %}
{% block title %}Editar Activo{% endblock %}
{% block content %}
<h2>Editar Activo</h2>
<form action="{{ url_for('edit_asset', id=asset['id']) }}" method="POST">
    <div class="form-group">
        <label for="asset_name">Nombre del Activo:</label>
        <input type="text" class="form-control" id="asset_name" name="asset_name" value="{{ asset['asset_name'] }}" required>
    </div>
    <div class="form-group">
        <label for="location">Ubicación:</label>
        <input type="text" class="form-control" id="location" name="location" value="{{ asset['location'] }}">
    </div>
    <div class="form-group">
        <label for="amount">Monto:</label>
        <input type="number" step="any" class="form-control" id="amount" name="amount" value="{{ asset['amount'] }}" required>
    </div>
    <div class="form-group">
        <label for="currency">Moneda:</label>
        <select class="form-control" id="currency" name="currency">
            <option value="USD" {% if asset['currency'] == 'USD' %}selected{% endif %}>USD</option>
            <option value="MXN" {% if asset['currency'] == 'MXN' %}selected{% endif %}>MXN</option>
        </select>
    </div>
    <div class="form-group">
        <label for="month">Mes (AAAA-MM):</label>
        <input type="text" class="form-control" id="month" name="month" value="{{ asset['month'] }}" required>
    </div>
 <!-- Dropdown de Clase -->
 <div class="form-group">
  <label for="class_id">Clase de Activo:</label>
  <select id="class_id" name="class_id" class="form-control" required>
    <option value="">-- Selecciona Clase --</option>
    {% for cls in classes %}
    <option value="{{ cls['id'] }}"
            {% if cls['id']==asset['class_id'] %}selected{% endif %}>
      {{ cls['name'] }}
    </option>
    {% endfor %}
  </select>
</div>

<!-- Dropdown de Subclase -->
<div class="form-group">
  <label for="subclass_id">Subclase:</label>
  <select id="subclass_id" name="subclass_id" class="form-control" required>
    <option value="">-- Selecciona Subclase --</option>
    {% for sub in subclasses %}
    <option value="{{ sub['id'] }}"
            {% if sub['id']==asset['subclass_id'] %}selected{% endif %}>
      {{ sub['name'] }}
    </option>
    {% endfor %}
  </select>
</div>

<!-- Dropdown de Estatus -->
<div class="form-group">
  <label for="estado">Estatus:</label>
  <select id="estado" name="estado" class="form-control" required>
    <option value="">-- Selecciona Estatus --</option>
    {% for st in statuses %}
    <option value="{{ st['name'] }}"
            {% if st['name']==asset['estado'] %}selected{% endif %}>
      {{ st['name'] }}
    </option>
    {% endfor %}
  </select>
</div>

<!-- Botón de envío -->
<button type="submit" class="btn btn-primary">Guardar Cambios</button>
</form>
{% block scripts %}
<script>
$(function(){
function loadSubclasses(classId){
  if(!classId) return;
  $.getJSON("/api/subclasses/" + classId, function(data){
    var $sub = $("#subclass_id").empty()
      .append($("<option>").text("-- Selecciona Subclase --").val(""));
    $.each(data, function(_, item){
      $sub.append(
        $("<option>").val(item.id).text(item.name)
      );
    });
  });
}
// Cuando cambie la clase, recargar subclases
$("#class_id").change(function(){
  loadSubclasses($(this).val());
});
});
</script>
{% endblock %}
{% endblock %}